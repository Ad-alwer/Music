<template>
  <nav class="d-flex align-items-center">
    <div class="div-icon  d-flex justify-content-center align-items-center">
      <svg
        width="131"
        height="25"
        viewBox="0 0 131 25"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        class="svg"
      >
        <path
          d="M47.84 20L47.818 10.76L43.286 18.372H41.68L37.17 10.958V20H33.826V4.6H36.774L42.538 14.17L48.214 4.6H51.14L51.184 20H47.84ZM66.3437 8.164L60.9977 20.726C60.4551 22.09 59.7804 23.0507 58.9737 23.608C58.1817 24.1653 57.2211 24.444 56.0917 24.444C55.4757 24.444 54.8671 24.3487 54.2657 24.158C53.6644 23.9673 53.1731 23.7033 52.7917 23.366L54.0457 20.924C54.3097 21.1587 54.6104 21.342 54.9477 21.474C55.2997 21.606 55.6444 21.672 55.9817 21.672C56.4511 21.672 56.8324 21.5547 57.1257 21.32C57.4191 21.1 57.6831 20.726 57.9177 20.198L57.9617 20.088L52.8357 8.164H56.3777L59.6997 16.194L63.0437 8.164H66.3437ZM75.7004 19.428C75.3631 19.6773 74.9451 19.868 74.4464 20C73.9624 20.1173 73.4491 20.176 72.9064 20.176C71.4984 20.176 70.4058 19.8167 69.6284 19.098C68.8658 18.3793 68.4844 17.3233 68.4844 15.93V11.068H66.6584V8.428H68.4844V5.546H71.9164V8.428H74.8644V11.068H71.9164V15.886C71.9164 16.3847 72.0411 16.7733 72.2904 17.052C72.5544 17.316 72.9211 17.448 73.3904 17.448C73.9331 17.448 74.3951 17.3013 74.7764 17.008L75.7004 19.428ZM82.8937 20.176C81.6471 20.176 80.5251 19.9193 79.5277 19.406C78.5451 18.878 77.7751 18.152 77.2177 17.228C76.6604 16.304 76.3817 15.2553 76.3817 14.082C76.3817 12.9087 76.6604 11.86 77.2177 10.936C77.7751 10.012 78.5451 9.29333 79.5277 8.78C80.5251 8.252 81.6471 7.988 82.8937 7.988C84.1404 7.988 85.2551 8.252 86.2377 8.78C87.2204 9.29333 87.9904 10.012 88.5477 10.936C89.1051 11.86 89.3837 12.9087 89.3837 14.082C89.3837 15.2553 89.1051 16.304 88.5477 17.228C87.9904 18.152 87.2204 18.878 86.2377 19.406C85.2551 19.9193 84.1404 20.176 82.8937 20.176ZM82.8937 17.36C83.7737 17.36 84.4924 17.0667 85.0497 16.48C85.6217 15.8787 85.9077 15.0793 85.9077 14.082C85.9077 13.0847 85.6217 12.2927 85.0497 11.706C84.4924 11.1047 83.7737 10.804 82.8937 10.804C82.0137 10.804 81.2877 11.1047 80.7157 11.706C80.1437 12.2927 79.8577 13.0847 79.8577 14.082C79.8577 15.0793 80.1437 15.8787 80.7157 16.48C81.2877 17.0667 82.0137 17.36 82.8937 17.36ZM98.8718 7.988C100.338 7.988 101.519 8.428 102.414 9.308C103.323 10.188 103.778 11.4933 103.778 13.224V20H100.346V13.752C100.346 12.8133 100.14 12.1167 99.7298 11.662C99.3191 11.1927 98.7251 10.958 97.9478 10.958C97.0824 10.958 96.3931 11.2293 95.8798 11.772C95.3664 12.3 95.1098 13.092 95.1098 14.148V20H91.6778V8.164H94.9558V9.55C95.4104 9.05133 95.9751 8.67 96.6498 8.406C97.3244 8.12733 98.0651 7.988 98.8718 7.988ZM118.612 14.126C118.612 14.17 118.59 14.478 118.546 15.05H109.592C109.753 15.7833 110.134 16.3627 110.736 16.788C111.337 17.2133 112.085 17.426 112.98 17.426C113.596 17.426 114.138 17.338 114.608 17.162C115.092 16.9713 115.539 16.678 115.95 16.282L117.776 18.262C116.661 19.538 115.033 20.176 112.892 20.176C111.557 20.176 110.376 19.9193 109.35 19.406C108.323 18.878 107.531 18.152 106.974 17.228C106.416 16.304 106.138 15.2553 106.138 14.082C106.138 12.9233 106.409 11.882 106.952 10.958C107.509 10.0193 108.264 9.29333 109.218 8.78C110.186 8.252 111.264 7.988 112.452 7.988C113.61 7.988 114.659 8.23733 115.598 8.736C116.536 9.23467 117.27 9.95333 117.798 10.892C118.34 11.816 118.612 12.894 118.612 14.126ZM112.474 10.584C111.696 10.584 111.044 10.804 110.516 11.244C109.988 11.684 109.665 12.2853 109.548 13.048H115.378C115.26 12.3 114.938 11.706 114.41 11.266C113.882 10.8113 113.236 10.584 112.474 10.584ZM124.879 20.176C123.896 20.176 122.935 20.0587 121.997 19.824C121.058 19.5747 120.31 19.2667 119.753 18.9L120.897 16.436C121.425 16.7733 122.063 17.052 122.811 17.272C123.559 17.4773 124.292 17.58 125.011 17.58C126.463 17.58 127.189 17.2207 127.189 16.502C127.189 16.1647 126.991 15.9227 126.595 15.776C126.199 15.6293 125.59 15.5047 124.769 15.402C123.801 15.2553 123.001 15.0867 122.371 14.896C121.74 14.7053 121.19 14.368 120.721 13.884C120.266 13.4 120.038 12.7107 120.038 11.816C120.038 11.068 120.251 10.408 120.677 9.836C121.117 9.24933 121.747 8.79467 122.569 8.472C123.405 8.14933 124.387 7.988 125.517 7.988C126.353 7.988 127.181 8.08333 128.003 8.274C128.839 8.45 129.528 8.69933 130.071 9.022L128.927 11.464C127.885 10.8773 126.749 10.584 125.517 10.584C124.783 10.584 124.233 10.6867 123.867 10.892C123.5 11.0973 123.317 11.3613 123.317 11.684C123.317 12.0507 123.515 12.3073 123.911 12.454C124.307 12.6007 124.937 12.74 125.803 12.872C126.771 13.0333 127.563 13.2093 128.179 13.4C128.795 13.576 129.33 13.906 129.785 14.39C130.239 14.874 130.467 15.5487 130.467 16.414C130.467 17.1473 130.247 17.8 129.807 18.372C129.367 18.944 128.721 19.3913 127.871 19.714C127.035 20.022 126.037 20.176 124.879 20.176Z"
          fill="#4343EF"
        />
        <rect width="24" height="24" rx="12" fill="#4343EF" />
        <path
          d="M17 6.44451V14.2176C17.0008 14.6642 16.8404 15.0982 16.5442 15.4507C16.248 15.8031 15.833 16.0538 15.3653 16.1628C14.8975 16.2717 14.4039 16.2328 13.9628 16.0521C13.5217 15.8714 13.1585 15.5594 12.931 15.1656C12.7035 14.7719 12.6246 14.319 12.707 13.8789C12.7895 13.4389 13.0284 13.037 13.3858 12.7372C13.7433 12.4373 14.1987 12.2568 14.6798 12.2242C15.1608 12.1916 15.6398 12.3088 16.0406 12.5573V9.23405L9.32476 10.7887V15.9943C9.32559 16.4409 9.16515 16.8749 8.86895 17.2274C8.57275 17.5798 8.15778 17.8305 7.69005 17.9395C7.22231 18.0485 6.72865 18.0095 6.28757 17.8288C5.84648 17.6482 5.4833 17.3361 5.25576 16.9423C5.02822 16.5486 4.94939 16.0957 5.03181 15.6556C5.11422 15.2156 5.35315 14.8137 5.7106 14.5139C6.06806 14.214 6.52351 14.0335 7.00454 14.0009C7.48557 13.9683 7.96456 14.0855 8.36535 14.334V8.22121C8.36537 8.12215 8.40117 8.02594 8.46705 7.94789C8.53293 7.86984 8.6251 7.81443 8.72891 7.79047L16.4041 6.01377C16.4748 5.99698 16.5486 5.99552 16.62 6.00952C16.6913 6.02351 16.7582 6.05257 16.8154 6.09444C16.8728 6.13601 16.9193 6.18913 16.9513 6.24978C16.9833 6.31043 16.9999 6.37702 17 6.44451Z"
          fill="white"
        />
      </svg>
    </div>
    <div
      class="div-main d-flex ms-3 align-items-center justify-content-between me-4"
    >
      <div class="d-flex justify-content-center gap-4 quick-access">
        <span
          class="text-capitalize pointer links position-relative"
          @click="goto('/explore#music')"
          >Music</span
        >
        <span
          class="text-capitalize pointer links position-relative"
          @click="goto('/explore#podcast')"
          >Podcast</span
        >
        <span
          class="text-capitalize pointer links position-relative"
          @click="goto('/explore#album')"
          >Album</span
        >
      </div>
      <div class="iconbar d-none ms-3" @click="sidemenu">
        <i class="fa-solid fa-bars text-secondary pointer"></i>
      </div>
      <div
        class="search-parent d-flex rounded-3 px-2 py-1 justify-content-between mt-1 ms-3 align-items-center"
      >
        <input
          type="text"
          class="search-input"
          maxlength="43"
          placeholder="Search ..."
          ref="searchinput"
        />
        <svg
          @click="
            this.$refs.searchinput.value
              ? goto(`search/${this.$refs.searchinput.value}`) &&
                this.refs.searchinput.value == null
              : null
          "
          class="search-icon pointer"
          width="20"
          height="20"
          viewBox="0 0 20 20"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M19 19L13.8571 13.8571M8.71429 16.4286C4.4538 16.4286 1 12.9748 1 8.71429C1 4.4538 4.4538 1 8.71429 1C12.9748 1 16.4286 4.4538 16.4286 8.71429C16.4286 12.9748 12.9748 16.4286 8.71429 16.4286Z"
            stroke="#B3B3BC"
            stroke-width="2"
          />
        </svg>
      </div>
    </div>
    <div class="d-flex align-items-center gap-3 px-4">
      <svg
        @click="changecomponent('laibrarytrack')"
        width="20"
        height="20"
        viewBox="0 0 20 18"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        class="pointer like-svg"
      >
        <path
          d="M5.5 1C3.0151 1 1 2.98817 1 5.44107C1 7.42116 1.7875 12.1206 9.5392 16.8712C9.67805 16.9555 9.83746 17 10 17C10.1625 17 10.3219 16.9555 10.4608 16.8712C18.2125 12.1206 19 7.42116 19 5.44107C19 2.98817 16.9849 1 14.5 1C12.0151 1 10 3.69156 10 3.69156C10 3.69156 7.9849 1 5.5 1Z"
          stroke="#B3B3BC"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
      <div class="position-relative">
        <notificationpopup
          @changecomponent="changecomponent"
          @read="changeread"
          @close="popups.notifacation = false"
          v-show="popups.notifacation"
         
        />

        <svg
          v-if="!unreadnofification"
          @click="popups.notifacation = true"
          width="20"
          height="22"
          viewBox="0 0 20 22"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          class="pointer"
        >
          <path
            d="M16 7C16 5.4087 15.3679 3.88258 14.2426 2.75736C13.1174 1.63214 11.5913 1 10 1C8.4087 1 6.88258 1.63214 5.75736 2.75736C4.63214 3.88258 4 5.4087 4 7C4 14 1 16 1 16H19C19 16 16 14 16 7Z"
            stroke="#B3B3BC"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
          <path
            d="M11.73 20C11.5542 20.3031 11.3019 20.5547 10.9982 20.7295C10.6946 20.9044 10.3504 20.9965 10 20.9965C9.64964 20.9965 9.30541 20.9044 9.00179 20.7295C8.69818 20.5547 8.44583 20.3031 8.27002 20"
            stroke="#B3B3BC"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
        <svg
          @click="popups.notifacation = true"
          v-if="unreadnofification"
          width="22"
          height="22"
          viewBox="0 0 20 22"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          class="pointer"
        >
          <path
            d="M16 7C16 5.4087 15.3679 3.88258 14.2426 2.75736C13.1174 1.63214 11.5913 1 10 1C8.4087 1 6.88258 1.63214 5.75736 2.75736C4.63214 3.88258 4 5.4087 4 7C4 14 1 16 1 16H19C19 16 16 14 16 7Z"
            stroke="#B3B3BC"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
          <path
            d="M11.73 20C11.5542 20.3031 11.3019 20.5547 10.9982 20.7295C10.6946 20.9044 10.3504 20.9965 10 20.9965C9.64964 20.9965 9.30541 20.9044 9.00179 20.7295C8.69818 20.5547 8.44583 20.3031 8.27002 20"
            stroke="#B3B3BC"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
          <circle cx="16" cy="3" r="3" fill="#4343EF" />
        </svg>
      </div>
      <div class="d-flex gap-2 ms-2 align-items-center ">
        <profilepopup
          v-if="popups.profile"
          :admin="user.isadmin"
          @close="popups.profile = false"
          class="profilepopup"
        />
        <img
          v-if="user.profile"
          class="rounded-circle img-thumbnail"
          :src="user.profile"
          alt=""
        />
        <img
          v-if="!user.profile"
          class="rounded-circle img-thumbnail"
          src="../../assets/img/icon.jpg"
          alt=""
        />
        <span class="text-capitalize fw-bold username">{{
          user.username
        }}</span>
        <svg
          class="pointer"
          @click="popups.profile = true"
          width="14"
          height="8"
          viewBox="0 0 14 8"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M1 1L7 7L13 1"
            stroke="#B3B3BC"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </div>
    </div>
  </nav>
</template>

<script>
import notificationpopup from "./notificationpopup.vue";
import profilepopup from "./profilepopup.vue";
import Register from "../Register.vue";
import info from "../../../default";
import axios from "axios";

export default {
  name: "header",
  data() {
    return {
      apiaddress: info.Api_ADDRESS,
      user: {},
      unreadnofification: false,
      popups: {
        notifacation: false,
        profile: false,
      },
    };
  },
  methods: {
    getdata: function () {
      axios
        .get(`${this.apiaddress}users/user`, {
          headers: {
            jwt: Register.methods.getcookies("jwt"),
          },
        })
        .then((res) => {
          this.user = res.data;
          this.user.notifacation
            ? this.user.notifacation.forEach((e) => {
                e.status == "unread" ? (this.unreadnofification = true) : null;
              })
            : null;
          this.senduser();
        });
    },
    goto: function (e) {
      location.href = e;
    },
    senduser: function () {
      this.$emit("getuser", this.user);
    },
    changecomponent: function (e) {
      this.$emit("changecomponent", e);
    },
    changeread: function (e) {
      this.unreadnofification = e;
    },
    sidemenu: function () {
      this.$emit("sidemenu", true);
    },
  },
  beforeMount() {
    if (Register.methods.getcookies("jwt")) {
      this.getdata();
    } else {
      location.href = "/login";
    }
  },
  components: {
    notificationpopup,
    profilepopup,
  },
  props: ["reload"],
  watch: {
    reload: function () {
      this.getdata();
    },
  },
};
</script>

<style scoped>
.svg {
  width: 280px;
}
.div-icon {
  width: 350px;
  margin-left: -20px;
}
.search-icon {
  width: 18px;
  height: 18px;
}
.search-input {
  caret-color: var(--blue-main);
  width: 350px;

  color: var(--gray-main);
}
.search-parent {
  width: 400px;
  height: 33px;
  border: 1px solid var(--gray-main);
}
.links {
  font-size: 21px;
  font-weight: 600;
  color: #4d4d56;
  transition: all 500ms;
}
.links:hover {
  color: var(--blue-main);
}
.links:hover::after {
  content: "";
  position: absolute;
  top: 29px;
  left: 30%;
  min-height: 2px;
  border-radius: 10%;
  min-width: 25px;
  background-color: var(--blue-main);
  z-index: 555;
}
.div-main {
  width: 60vw;
}
img {
  width: 45px;
  height: 45px;
}

@media screen and (max-width: 767px) {
  .quick-access,
  .search-parent,
  .div-icon,
  .username,
  .like-svg {
    display: none !important;
  }
  .div-main {
    display: flex;
    justify-content: start;
  }
  .iconbar {
    display: block !important;
  }
 

  
}
</style>
